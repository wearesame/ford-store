<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><!= title !></title>
    <link href="/style.css" rel="stylesheet" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>

  <body>
    <div class="min-h-screen flex items-center justify-center">
      <div class="bg-white p-8 rounded-lg shadow-md w-[70%] relative">
        <div class="mb-6">
          <h2 class="text-xl font-bold">ลงทะเบียน</h2>
          <p class="text-[12px] w-150 truncate text-black/70">
            Lorem ipsum dolor sit amet consectetur adipisicing elit. Harum eos
            iste culpa id quaerat, perferendis fugit quam illo assumenda
            cupiditate nemo, nulla labore veritatis ipsam odio eligendi
            provident animi incidunt?
          </p>
        </div>
        <form id="register-form">
          <div class="grid grid-cols-2 gap-4">
            <div class="flex gap-2">
              <div>
                <label
                  for="username"
                  class="block text-gray-700 font-bold mb-2"
                >
                  ชื่อ
                </label>
                <input
                  type="text"
                  id="fname"
                  name="fname"
                  class="main-input"
                  required
                />
              </div>
              <div>
                <label
                  for="username"
                  class="block text-gray-700 font-bold mb-2"
                >
                  สกุล
                </label>
                <input
                  type="text"
                  id="lname"
                  name="lname"
                  class="main-input"
                  required
                />
              </div>
            </div>
            <div>
              <label for="username" class="block text-gray-700 font-bold mb-2">
                ที่อยู่
              </label>
              <input
                type="text"
                id="address"
                name="address"
                class="main-input"
                required
              />
            </div>
            <div>
              <label for="username" class="block text-gray-700 font-bold mb-2">
                ชื่อผู้ใช้
              </label>
              <input
                type="text"
                id="username"
                name="username"
                class="main-input"
                required
              />
            </div>
            <div>
              <label for="username" class="block text-gray-700 font-bold mb-2">
                เบอร์โทร
              </label>
              <input
                type="text"
                id="phone"
                name="phone"
                class="main-input"
                required
              />
            </div>
          </div>

          <div class="flex gap-2 mt-2 *:w-full">
            <div>
              <label for="password" class="block text-gray-700 font-bold mb-2">
                รหัสผ่าน
              </label>
              <input
                type="password"
                id="password"
                name="password"
                class="main-input"
                required
                minlength="6"
              />
              <p class="text-sm text-gray-600 mt-1">
                รหัสผ่านต้องมีอย่างน้อย 6 ตัวอักษร
              </p>
            </div>

            <div>
              <label
                for="confirmPassword"
                class="block text-gray-700 font-bold mb-2"
              >
                ยืนยันรหัสผ่าน
              </label>
              <input
                type="password"
                id="confirmPassword"
                name="confirmPassword"
                class="main-input"
                required
              />
            </div>
          </div>

          <button
            type="submit"
            class="btn-primary h-8 w-[20%] absolute right-8 bottom-8"
          >
            ลงทะเบียน
          </button>
        </form>

        <p class="text-start mt-4 text-gray-600">
          มีบัญชีอยู่แล้ว?
          <a href="/login" class="text-purple-500 hover:underline"
            >เข้าสู่ระบบ</a
          >
        </p>
      </div>
    </div>

    <script type="text/javascript">
      $(document).ready(function () {
        $("#register-form").on("submit", function (e) {
          e.preventDefault();

          // รวบรวมข้อมูลจากฟอร์ม
          const formData = {
            username: $("#username").val(),
            password: $("#password").val(),
            address: $("#address").val(),
            phone: $("#phone").val(),
            fname: $("#fname").val(),
            lname: $("#lname").val(),
            confirmPassword: $("#confirmPassword").val(),
          };

          // ส่งข้อมูลด้วย jQuery AJAX
          $.ajax({
            url: "/register",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(formData),
            success: function (response) {
              // แสดง SweetAlert เมื่อสำเร็จ
              Swal.fire({
                icon: "success",
                title: "สำเร็จ!",
                text: response.msg,
                showConfirmButton: false,
                timer: 2000,
              }).then(function () {
                // Redirect ไป login page
                window.location.href = "/login";
              });
            },
            error: function (xhr) {
              // แสดง SweetAlert เมื่อเกิดข้อผิดพลาด
              const response = xhr.responseJSON;
              Swal.fire({
                icon: "error",
                title: "เกิดข้อผิดพลาด",
                text: response ? response.msg : "เกิดข้อผิดพลาดในการเชื่อมต่อ",
              });
            },
          });
        });
      });
    </script>
  </body>
</html>
